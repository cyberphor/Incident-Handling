# Windows Access Control Concepts
## Table of Contents
* [Introduction](#introduction)
* [Account Policies](#account-policies)
  * [Passwords](#passwords)
  * [Account Lockout](#account-lockout)
* [User Rights Assignment](#user-rights-assignment)
  * [User Rights](#user-rights)
  * [Privileges](#privileges)
* [Security Access Tokens (SATs)](#security-access-tokens-sats)
* [User Account Control (UAC)](#user-account-control-uac)
* [Integrity Levels](#integrity-levels)
* [File Permissions](#file-permissions)
* [References](#references)

## Introduction
Most of the access control options discussed here are managed using a collection of Group Policy settings under the following path: Computer Configuration > Windows Settings > Security Settings. 

## Account Policies
### Passwords
* Length
* Complexity
* Age
* History
* Store passwords using reversible encryption: if enabled, this setting allows encrypted passwords to be decrypted. 

### Account Lockout
* Threshold: determines the number of failed sign-in attempts that will cause a user account to be locked.
* Duration: determines the number of minutes that a locked-out account remains locked out before automatically becoming unlocked.
* Lockout counter: determines the number of minutes that must elapse from the time a user fails to log on before the failed logon attempt counter is reset to 0. 

**Best Practice**  
It is best practice to use 15 as the value for the "Reset account lockout counter after" setting. If this value is applied, users who fail to logon multiple times within the same 15 minute window will lockout their account.

*References*  
* [https://docs.microsoft.com/en-us/archive/blogs/secguide/configuring-account-lockout](https://docs.microsoft.com/en-us/archive/blogs/secguide/configuring-account-lockout)

## User Rights Assignment
### User Rights
User rights describe who can logon to a system and the logon methods they can use. The Logon methods available for configuration include the following: interactively (think "locally"), remotely, as a batch job, and as a service. User rights are configured using a collection of Group Policy settings called "User Rights Assignment." As an example, you can prevent the local "Guest" account from logging-on by adding assigning them "Deny log on locally." Alternatively, if you needed to allow someone to access a Domain Controller using their standard user account (for whatever reason), you would assign them "Allow log on locally." 
* Allow log on locally
* Allow log on through Remote Desktop Services
* Deny log on as a batch job
* Deny log on as a service
* Deny log on locally
* Deny log on through Remote Desktop Services 
* Logon on as a batch job
* Logon on as a service

**Best Practice**  
It is best practice to do the following:
* Deny the "Guest" account the right to logon locally
* Deny the "Domain Users" group the right to logon locally to Domain Controllers (this is implicit by default)
* Deny the "Domain Administrators" group the right to logon locally to workstations

*References*  
* [https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/allow-log-on-locally](https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/allow-log-on-locally)  
* [https://www.stigviewer.com/stig/windows_10/2019-09-25/finding/V-63877](https://www.stigviewer.com/stig/windows_10/2019-09-25/finding/V-63877)

### Privileges
Privileges represent what users are allowed to do to other processes. The privileges below are considered maleficent. 
* Act as a Part of the Operating System: create a new logon session via username/password or group memberships. 
* Create a Token Object: execute a command under the context of a new SAT. 
* Debug Programs: inject a malicious DLL into a process or dump password hashes.
* Impersonate a Client: steal someone’s SAT after they authenticate. 
* Load and Unload Device Drivers: load drivers and execute malicious commands.  
* Restore Files and Directories: bypass NTFS permissions and replace any file (i.e. OS or application binaries).
* Take Ownership: change permissions (the ACL) for processes, threads, registry keys, etc.

### Security Access Tokens (SATs)
A user's SAT is attached to every process they launch. It represents what they are authorized to do and is generated by the Local Security Authority Subsystem Service (LSASS). A SAT includes the following elements:
* User's SID
* SIDs of user's global/local group memberships
* SID of user's integrity level
* Privileges on the local system
* Active Directory attributes

### User Account Control (UAC)
UAC prevents processes from silently doing things that will have a system-wide impact. UAC does this by separating a user’s privileges into two different SATs and requiring the  express authorization of an administrator before elevating to the SAT with a higher integrity level. Elevating one’s privileges via UAC happens in either credential or consent mode. In credential mode, a user will be prompted for administrator credentials. Most users will experience this mode. In consent mode, a user will be prompted for consent. Administrators will be asked for consent instead of their credentials as they have already proven their identity at login. The example below demonstrates how to elevate from a medium integrity level to a high integrity level. 

```bash
net user administrator password123
# Access is denied. 

powershell Start-Process cmd.exe -Verb RunAs
net user administrator password123
# The command completed successfully.
```

### Integrity Levels
Mandatory Integrity Control (MIC) allows the Windows kernel to “...enforce new access control restrictions that cannot be defined by granting user or group permissions in access control lists (ACLs).” MIC represents Microsoft’s implementation of the Biba Mandatory Access Control (MAC) model and is enforced prior to file permissions. MIC labels, also known as mandatory labels, integrity labels, or integrity levels, prevent processes of lower integrity from reading, writing, and/or executing objects of higher integrity. MIC labels are also partly determined by the type of privileges allocated to a user. A user’s integrity level will be one of the following: 
* System: SYSTEM
* High: administrator
* Medium: standard
* Low: very restricted

### File Permissions
Text goes here.

### References
* https://isc.sans.edu/forums/diary/Limiting+Exploit+Capabilities+by+Using+Windows+Integrity+Levels/10531/
* [https://www.stigviewer.com/stig/windows_10/](https://www.stigviewer.com/stig/windows_10/)
